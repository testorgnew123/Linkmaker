<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>QR Profile</title>
<link href="https://fonts.googleapis.com/css2?family=Syne:wght@400;500;600;700;800&family=Outfit:wght@300;400;500;600&display=swap" rel="stylesheet">
<style>
*, *::before, *::after { margin: 0; padding: 0; box-sizing: border-box; }
html { scroll-behavior: smooth; }

:root {
  --bg: #080c14; --surface: #0f1624; --surface2: #161e30; --surface3: #1c2640;
  --border: rgba(255,255,255,0.07); --border2: rgba(255,255,255,0.12);
  --accent: #6c63ff; --accent2: #ff6b6b; --accent3: #43e97b;
  --text: #e8eaf2; --text2: #8892a4; --text3: #4e5a6e; --white: #ffffff;
  --radius: 18px; --radius-sm: 10px;
  --transition: all 0.3s cubic-bezier(0.4,0,0.2,1);
}

body {
  font-family: 'Outfit', sans-serif;
  background: var(--screen-bg, var(--bg));
  color: var(--text);
  min-height: 100vh;
}

/* Skeleton loader */
.skeleton { display: flex; flex-direction: column; align-items: center; padding: 80px 24px; gap: 16px; }
.skeleton-circle { width: 88px; height: 88px; border-radius: 50%; background: var(--surface2); animation: shimmer 1.5s infinite; }
.skeleton-line { height: 16px; border-radius: 8px; background: var(--surface2); animation: shimmer 1.5s infinite; }
.skeleton-line.w60 { width: 60%; }
.skeleton-line.w40 { width: 40%; }
.skeleton-line.w80 { width: 80%; }
.skeleton-card { width: 90%; height: 60px; border-radius: var(--radius); background: var(--surface2); animation: shimmer 1.5s infinite; }
@keyframes shimmer { 0%,100%{opacity:0.4} 50%{opacity:0.8} }

/* 404 */
.not-found { display:flex;flex-direction:column;align-items:center;justify-content:center;min-height:80vh;gap:16px;padding:24px;text-align:center; }
.not-found h1 { font-family:'Syne',sans-serif; font-size:48px; font-weight:800; color:var(--white); }
.not-found p { font-size:16px; color:var(--text2); max-width:400px; }
.not-found a { color:var(--accent); text-decoration:none; font-weight:600; }

/* Profile styles (same as editor preview) */
.profile-page { min-height:100%; position:relative; padding-bottom:40px; max-width:500px; margin:0 auto; }

.profile-hero { position:relative; padding:52px 24px 36px; text-align:center; overflow:hidden; }
.profile-hero-bg { position:absolute; inset:0; z-index:0; background:var(--hero-bg, linear-gradient(160deg,#0f1020,#0d1520)); }
.profile-hero-mesh { position:absolute; inset:0; z-index:0; opacity:0.5; background-image:radial-gradient(ellipse 70% 50% at 50% -10%,var(--hero-glow,rgba(108,99,255,0.35)) 0%,transparent 70%),radial-gradient(ellipse 40% 40% at 80% 80%,var(--hero-glow2,rgba(108,99,255,0.2)) 0%,transparent 60%); }
.profile-hero > * { position:relative; z-index:1; }

.avatar-ring { display:inline-flex; position:relative; margin-bottom:20px; }
.avatar-ring::before { content:''; position:absolute; inset:-3px; border-radius:50%; background:conic-gradient(var(--accent-color,var(--accent)),var(--accent-color2,#ff6b6b),var(--accent-color,var(--accent))); animation:spin 6s linear infinite; z-index:0; }
@keyframes spin { to { transform:rotate(360deg); } }

.avatar-wrap { width:88px; height:88px; border-radius:50%; background:var(--surface2); display:flex; align-items:center; justify-content:center; position:relative; z-index:1; overflow:hidden; font-family:'Syne',sans-serif; font-size:32px; font-weight:800; color:var(--accent-color,var(--accent)); border:3px solid var(--bg); }
.avatar-img { width:100%; height:100%; object-fit:cover; }

.profile-name { font-family:'Syne',sans-serif; font-size:26px; font-weight:800; color:var(--white); letter-spacing:-0.5px; margin-bottom:4px; line-height:1.2; }
.profile-tagline { font-size:13px; font-weight:400; color:rgba(255,255,255,0.55); letter-spacing:0.5px; margin-bottom:14px; }
.profile-bio { font-size:13px; color:rgba(255,255,255,0.45); line-height:1.65; max-width:280px; margin:0 auto 20px; }

.verified-badge { display:inline-flex; align-items:center; gap:5px; background:rgba(255,255,255,0.07); border:1px solid rgba(255,255,255,0.1); border-radius:20px; padding:4px 10px; font-size:11px; color:rgba(255,255,255,0.5); margin-bottom:20px; backdrop-filter:blur(8px); }
.verified-badge svg { color:var(--accent-color,var(--accent)); }

.social-strip { display:flex; flex-wrap:wrap; justify-content:center; gap:10px; padding:0 24px; margin-bottom:32px; }
.social-pill { display:flex; align-items:center; gap:7px; background:rgba(255,255,255,0.06); border:1px solid rgba(255,255,255,0.09); border-radius:50px; padding:8px 14px; cursor:pointer; text-decoration:none; transition:var(--transition); animation:fadeSlideUp 0.5s ease both; backdrop-filter:blur(8px); }
.social-pill:hover { background:rgba(255,255,255,0.12); border-color:rgba(255,255,255,0.2); transform:translateY(-2px); }
.social-pill-icon { width:18px; height:18px; flex-shrink:0; }
.social-pill-label { font-size:12px; font-weight:500; color:rgba(255,255,255,0.7); }

.cards-container { padding:0 16px; display:flex; flex-direction:column; gap:12px; }

.qr-card { border-radius:var(--radius); overflow:hidden; border:1px solid rgba(255,255,255,0.07); position:relative; animation:fadeSlideUp 0.5s ease both; transition:var(--transition); }
.qr-card:hover { border-color:rgba(255,255,255,0.14); transform:translateY(-2px); box-shadow:0 12px 40px rgba(0,0,0,0.4); }

.card-link { display:flex; align-items:center; gap:14px; padding:16px 18px; text-decoration:none; background:rgba(255,255,255,0.04); backdrop-filter:blur(12px); }
.card-link-icon { width:44px; height:44px; border-radius:12px; display:flex; align-items:center; justify-content:center; flex-shrink:0; font-size:20px; }
.card-link-content { flex:1; min-width:0; }
.card-link-title { font-size:15px; font-weight:600; color:var(--white); margin-bottom:2px; }
.card-link-sub { font-size:12px; color:var(--text2); white-space:nowrap; overflow:hidden; text-overflow:ellipsis; }
.card-link-arrow { color:var(--text3); flex-shrink:0; transition:var(--transition); }
.card-link:hover .card-link-arrow { transform:translateX(4px); color:var(--accent-color,var(--accent)); }

.card-expand-btn { display:flex; align-items:center; justify-content:space-between; padding:16px 18px; cursor:pointer; background:rgba(255,255,255,0.04); backdrop-filter:blur(12px); border:none; width:100%; text-align:left; transition:var(--transition); gap:14px; color:var(--text); font-family:'Outfit',sans-serif; }
.card-expand-btn:hover { background:rgba(255,255,255,0.07); }
.card-expand-btn .card-link-icon { font-size:20px; }
.card-expand-label { flex:1; }
.card-expand-title { font-size:15px; font-weight:600; color:var(--white); margin-bottom:2px; }
.card-expand-sub { font-size:12px; color:var(--text2); }
.card-expand-chevron { color:var(--text3); transition:var(--transition); flex-shrink:0; }
.card-expand-btn.expanded .card-expand-chevron { transform:rotate(180deg); color:var(--accent-color,var(--accent)); }

.card-embed-area { display:none; border-top:1px solid rgba(255,255,255,0.06); }
.card-embed-area.open { display:block; }
.card-embed-area iframe { width:100%; display:block; border:none; }
.map-embed-frame { height:200px; filter:grayscale(0.3) contrast(1.05); }

.website-preview-bar { display:flex; align-items:center; gap:8px; padding:8px 14px; background:rgba(255,255,255,0.03); border-top:1px solid rgba(255,255,255,0.06); }
.browser-dots2 { display:flex; gap:4px; }
.browser-dot2 { width:7px; height:7px; border-radius:50%; }
.url-bar { flex:1; background:rgba(255,255,255,0.06); border-radius:6px; padding:3px 10px; font-size:10px; color:var(--text3); font-family:monospace; }
.website-preview-placeholder { width:100%; height:180px; display:flex; flex-direction:column; align-items:center; justify-content:center; gap:6px; background:linear-gradient(135deg,rgba(108,99,255,0.15),rgba(255,107,107,0.1)); font-family:'Syne',sans-serif; }
.website-preview-placeholder .site-name { font-size:18px; font-weight:700; color:rgba(255,255,255,0.6); }
.website-preview-placeholder .site-url { font-size:11px; color:rgba(255,255,255,0.3); font-family:monospace; }

.gbiz-inner { padding:18px 18px 6px; background:rgba(255,255,255,0.04); }
.gbiz-brand-row { display:flex; align-items:center; gap:12px; margin-bottom:14px; }
.gbiz-g-icon { width:40px; height:40px; border-radius:10px; display:flex; align-items:center; justify-content:center; background:#fff; box-shadow:0 2px 8px rgba(0,0,0,0.3); flex-shrink:0; }
.gbiz-g-icon svg { width:24px; height:24px; }
.gbiz-biz-name { font-size:15px; font-weight:700; color:var(--white); }
.gbiz-biz-cat { font-size:11px; color:var(--text2); }
.stars2 { display:flex; gap:2px; margin-bottom:4px; }
.star2 { color:#f5c518; font-size:14px; }
.gbiz-stats-row { display:flex; gap:16px; margin-bottom:14px; }
.gbiz-stat { text-align:center; }
.gbiz-stat-val { font-size:18px; font-weight:700; color:var(--white); }
.gbiz-stat-label { font-size:10px; color:var(--text3); text-transform:uppercase; letter-spacing:0.5px; }
.gbiz-divider { width:1px; background:var(--border); }
.gbiz-actions { display:flex; gap:8px; padding:12px 18px; border-top:1px solid rgba(255,255,255,0.06); background:rgba(255,255,255,0.02); }
.gbiz-action-btn { flex:1; padding:9px; border-radius:10px; border:none; cursor:pointer; font-size:12px; font-weight:600; font-family:'Outfit',sans-serif; transition:var(--transition); }
.gbiz-action-primary { background:var(--accent-color,var(--accent)); color:white; }
.gbiz-action-secondary { background:rgba(255,255,255,0.07); color:var(--text); }
.gbiz-action-btn:hover { opacity:0.85; transform:translateY(-1px); }

.cta-card { padding:20px 18px; background:linear-gradient(135deg,var(--cta-from,rgba(108,99,255,0.2)),var(--cta-to,rgba(255,107,107,0.15))); position:relative; overflow:hidden; backdrop-filter:blur(12px); }
.cta-card::before { content:''; position:absolute; inset:0; background:var(--cta-shine,radial-gradient(ellipse 80% 60% at 0% 0%,rgba(255,255,255,0.05) 0%,transparent 60%)); }
.cta-card > * { position:relative; z-index:1; }
.cta-badge { display:inline-flex; align-items:center; gap:5px; background:rgba(255,255,255,0.1); border:1px solid rgba(255,255,255,0.15); border-radius:20px; padding:4px 10px; font-size:10px; font-weight:700; color:rgba(255,255,255,0.8); letter-spacing:1px; text-transform:uppercase; margin-bottom:10px; }
.cta-title { font-family:'Syne',sans-serif; font-size:18px; font-weight:700; color:var(--white); margin-bottom:6px; line-height:1.2; }
.cta-desc { font-size:12px; color:rgba(255,255,255,0.55); line-height:1.6; margin-bottom:16px; }
.cta-action { display:inline-flex; align-items:center; gap:8px; background:var(--white); color:var(--bg); border-radius:10px; padding:10px 18px; font-size:13px; font-weight:700; text-decoration:none; transition:var(--transition); border:none; cursor:pointer; font-family:'Outfit',sans-serif; }
.cta-action:hover { transform:translateY(-2px); box-shadow:0 8px 24px rgba(0,0,0,0.3); }

.profile-footer { text-align:center; padding:32px 24px 20px; position:relative; z-index:1; }
.powered-by { display:inline-flex; align-items:center; gap:6px; font-size:11px; color:var(--text3); text-decoration:none; transition:var(--transition); }
.powered-by:hover { color:var(--text2); }
.powered-by-logo { font-family:'Syne',sans-serif; font-weight:700; }
.powered-by-logo span { color:var(--accent); }

@keyframes fadeSlideUp { from{opacity:0;transform:translateY(20px)} to{opacity:1;transform:translateY(0)} }

.qr-card:nth-child(1){animation-delay:0.1s} .qr-card:nth-child(2){animation-delay:0.15s} .qr-card:nth-child(3){animation-delay:0.2s}
.qr-card:nth-child(4){animation-delay:0.25s} .qr-card:nth-child(5){animation-delay:0.3s} .qr-card:nth-child(6){animation-delay:0.35s}
.social-pill:nth-child(1){animation-delay:0.05s} .social-pill:nth-child(2){animation-delay:0.1s} .social-pill:nth-child(3){animation-delay:0.15s}
.social-pill:nth-child(4){animation-delay:0.2s} .social-pill:nth-child(5){animation-delay:0.25s}

/* Themes */
.theme-midnight{--screen-bg:#080c14;--hero-bg:linear-gradient(160deg,#0f1020,#0d1520);--hero-glow:rgba(108,99,255,0.35);--hero-glow2:rgba(108,99,255,0.2);--accent-color:#6c63ff;--accent-color2:#ff6b6b;--cta-from:rgba(108,99,255,0.2);--cta-to:rgba(255,107,107,0.15)}
.theme-emerald{--screen-bg:#050d0a;--hero-bg:linear-gradient(160deg,#051209,#061510);--hero-glow:rgba(16,185,129,0.4);--hero-glow2:rgba(67,233,123,0.2);--accent-color:#10b981;--accent-color2:#43e97b;--cta-from:rgba(16,185,129,0.2);--cta-to:rgba(67,233,123,0.1)}
.theme-crimson{--screen-bg:#0d0507;--hero-bg:linear-gradient(160deg,#150508,#1a0808);--hero-glow:rgba(239,68,68,0.4);--hero-glow2:rgba(251,113,133,0.2);--accent-color:#ef4444;--accent-color2:#fb7185;--cta-from:rgba(239,68,68,0.2);--cta-to:rgba(251,113,133,0.1)}
.theme-gold{--screen-bg:#0a0800;--hero-bg:linear-gradient(160deg,#120f00,#160e00);--hero-glow:rgba(245,158,11,0.4);--hero-glow2:rgba(251,191,36,0.2);--accent-color:#f59e0b;--accent-color2:#fbbf24;--cta-from:rgba(245,158,11,0.2);--cta-to:rgba(251,191,36,0.1)}
.theme-ocean{--screen-bg:#020b12;--hero-bg:linear-gradient(160deg,#020e18,#011520);--hero-glow:rgba(14,165,233,0.4);--hero-glow2:rgba(56,189,248,0.2);--accent-color:#0ea5e9;--accent-color2:#38bdf8;--cta-from:rgba(14,165,233,0.2);--cta-to:rgba(56,189,248,0.1)}
.theme-rose{--screen-bg:#0d0408;--hero-bg:linear-gradient(160deg,#150610,#180814);--hero-glow:rgba(236,72,153,0.4);--hero-glow2:rgba(251,113,133,0.2);--accent-color:#ec4899;--accent-color2:#f43f5e;--cta-from:rgba(236,72,153,0.2);--cta-to:rgba(244,63,94,0.1)}
.theme-slate{--screen-bg:#0a0d12;--hero-bg:linear-gradient(160deg,#0d1018,#111420);--hero-glow:rgba(148,163,184,0.3);--hero-glow2:rgba(203,213,225,0.15);--accent-color:#94a3b8;--accent-color2:#cbd5e1;--cta-from:rgba(148,163,184,0.15);--cta-to:rgba(203,213,225,0.08)}
.theme-amber{--screen-bg:#080600;--hero-bg:linear-gradient(160deg,#0d0900,#100b00);--hero-glow:rgba(217,119,6,0.4);--hero-glow2:rgba(245,158,11,0.2);--accent-color:#d97706;--accent-color2:#f59e0b;--cta-from:rgba(217,119,6,0.2);--cta-to:rgba(245,158,11,0.1)}
.theme-violet{--screen-bg:#06040e;--hero-bg:linear-gradient(160deg,#0a0614,#0d0818);--hero-glow:rgba(167,139,250,0.4);--hero-glow2:rgba(192,132,252,0.2);--accent-color:#a78bfa;--accent-color2:#c084fc;--cta-from:rgba(167,139,250,0.2);--cta-to:rgba(192,132,252,0.1)}
.theme-cyan{--screen-bg:#010c0e;--hero-bg:linear-gradient(160deg,#011018,#01141c);--hero-glow:rgba(6,182,212,0.4);--hero-glow2:rgba(34,211,238,0.2);--accent-color:#06b6d4;--accent-color2:#22d3ee;--cta-from:rgba(6,182,212,0.2);--cta-to:rgba(34,211,238,0.1)}
.theme-neon_tokyo{--screen-bg:#0a0014;--hero-bg:linear-gradient(160deg,#0a0014,#12002a);--hero-glow:rgba(255,0,255,0.45);--hero-glow2:rgba(0,255,255,0.25);--accent-color:#ff00ff;--accent-color2:#00ffff;--cta-from:rgba(255,0,255,0.2);--cta-to:rgba(0,255,255,0.1)}
.theme-arctic{--screen-bg:#f0f4f8;--hero-bg:linear-gradient(160deg,#e8f0f8,#dce8f5);--hero-glow:rgba(59,130,246,0.2);--hero-glow2:rgba(147,197,253,0.15);--accent-color:#2563eb;--accent-color2:#3b82f6;--cta-from:rgba(59,130,246,0.1);--cta-to:rgba(147,197,253,0.08)}
.theme-sand_dune{--screen-bg:#1a1208;--hero-bg:linear-gradient(160deg,#1a1208,#241808);--hero-glow:rgba(217,168,68,0.35);--hero-glow2:rgba(180,120,40,0.2);--accent-color:#d9a844;--accent-color2:#c8903a;--cta-from:rgba(217,168,68,0.2);--cta-to:rgba(180,120,40,0.1)}
.theme-deep_space{--screen-bg:#010108;--hero-bg:linear-gradient(160deg,#010108,#030318);--hero-glow:rgba(100,60,255,0.5);--hero-glow2:rgba(180,60,255,0.3);--accent-color:#6433ff;--accent-color2:#b43cff;--cta-from:rgba(100,60,255,0.2);--cta-to:rgba(180,60,255,0.1)}
.theme-sakura{--screen-bg:#1a0810;--hero-bg:linear-gradient(160deg,#1a0810,#240818);--hero-glow:rgba(255,150,180,0.4);--hero-glow2:rgba(255,100,150,0.2);--accent-color:#ff96b4;--accent-color2:#ff6496;--cta-from:rgba(255,150,180,0.2);--cta-to:rgba(255,100,150,0.1)}
.theme-matrix{--screen-bg:#000800;--hero-bg:linear-gradient(160deg,#000800,#001200);--hero-glow:rgba(0,255,70,0.4);--hero-glow2:rgba(0,200,50,0.2);--accent-color:#00ff46;--accent-color2:#00c832;--cta-from:rgba(0,255,70,0.15);--cta-to:rgba(0,200,50,0.08)}
.theme-sunset{--screen-bg:#1a0500;--hero-bg:linear-gradient(160deg,#1a0500,#2d0800);--hero-glow:rgba(255,100,0,0.45);--hero-glow2:rgba(255,180,0,0.25);--accent-color:#ff6400;--accent-color2:#ffb400;--cta-from:rgba(255,100,0,0.2);--cta-to:rgba(255,180,0,0.1)}
.theme-nordic{--screen-bg:#080e18;--hero-bg:linear-gradient(160deg,#080e18,#0d1830);--hero-glow:rgba(100,160,220,0.35);--hero-glow2:rgba(140,200,255,0.2);--accent-color:#64a0dc;--accent-color2:#8cc8ff;--cta-from:rgba(100,160,220,0.18);--cta-to:rgba(140,200,255,0.1)}
.theme-bubblegum{--screen-bg:#1a0818;--hero-bg:linear-gradient(160deg,#1a0818,#280a28);--hero-glow:rgba(255,80,200,0.4);--hero-glow2:rgba(200,80,255,0.25);--accent-color:#ff50c8;--accent-color2:#c850ff;--cta-from:rgba(255,80,200,0.2);--cta-to:rgba(200,80,255,0.1)}
.theme-corporate{--screen-bg:#020810;--hero-bg:linear-gradient(160deg,#020810,#041428);--hero-glow:rgba(30,80,180,0.4);--hero-glow2:rgba(60,120,220,0.2);--accent-color:#1e50b4;--accent-color2:#3c78dc;--cta-from:rgba(30,80,180,0.2);--cta-to:rgba(60,120,220,0.1)}
.theme-luxury{--screen-bg:#050505;--hero-bg:linear-gradient(160deg,#080808,#101010);--hero-glow:rgba(212,175,55,0.35);--hero-glow2:rgba(180,140,30,0.2);--accent-color:#d4af37;--accent-color2:#b48c1e;--cta-from:rgba(212,175,55,0.15);--cta-to:rgba(180,140,30,0.08)}
.theme-terracotta{--screen-bg:#140a06;--hero-bg:linear-gradient(160deg,#140a06,#201008);--hero-glow:rgba(200,90,50,0.4);--hero-glow2:rgba(180,120,60,0.25);--accent-color:#c85a32;--accent-color2:#b4783c;--cta-from:rgba(200,90,50,0.2);--cta-to:rgba(180,120,60,0.1)}
.theme-mint{--screen-bg:#030d08;--hero-bg:linear-gradient(160deg,#030d08,#051810);--hero-glow:rgba(50,200,140,0.4);--hero-glow2:rgba(80,230,160,0.2);--accent-color:#32c88c;--accent-color2:#50e6a0;--cta-from:rgba(50,200,140,0.2);--cta-to:rgba(80,230,160,0.1)}
.theme-retrowave{--screen-bg:#0a0018;--hero-bg:linear-gradient(160deg,#0a0018,#180030);--hero-glow:rgba(255,50,150,0.45);--hero-glow2:rgba(80,0,255,0.3);--accent-color:#ff3296;--accent-color2:#5000ff;--cta-from:rgba(255,50,150,0.2);--cta-to:rgba(80,0,255,0.12)}
.theme-mono{--screen-bg:#080808;--hero-bg:linear-gradient(160deg,#080808,#141414);--hero-glow:rgba(200,200,200,0.2);--hero-glow2:rgba(160,160,160,0.12);--accent-color:#d0d0d0;--accent-color2:#a0a0a0;--cta-from:rgba(200,200,200,0.1);--cta-to:rgba(160,160,160,0.06)}

/* Arctic light-mode overrides */
.theme-arctic{--text:#1a2540;--text2:#4a5568;--text3:#718096;--border:rgba(0,0,0,0.08)}
.theme-arctic .profile-name{color:#1a2540}
.theme-arctic .card-link-title,.theme-arctic .card-expand-title{color:#1a2540}
.theme-arctic .card-link-sub,.theme-arctic .card-expand-sub{color:#4a5568}
.theme-arctic .profile-tagline{color:#4a5568}
.theme-arctic .profile-bio{color:#718096}
.theme-arctic .qr-card{background:rgba(0,0,0,0.04);border-color:rgba(0,0,0,0.08)}
.theme-arctic .gbiz-biz-name{color:#1a2540}
.theme-arctic .gbiz-stat-val{color:#1a2540}
.theme-arctic .gbiz-stat-label,.theme-arctic .gbiz-biz-cat{color:#718096}
.theme-arctic .cta-title{color:#1a2540}
.theme-arctic .cta-desc{color:#4a5568}
.theme-arctic .verified-badge{background:rgba(0,0,0,0.05);border-color:rgba(0,0,0,0.1);color:#4a5568}
.theme-arctic .powered-by{color:#718096}
.theme-arctic .social-pill{background:rgba(0,0,0,0.05);border-color:rgba(0,0,0,0.08)}
.theme-arctic .social-pill-label{color:#4a5568}
</style>
</head>
<body>

<div id="app">
  <!-- Skeleton loader shown while fetching -->
  <div class="skeleton" id="skeleton">
    <div class="skeleton-circle"></div>
    <div class="skeleton-line w60"></div>
    <div class="skeleton-line w40"></div>
    <div class="skeleton-line w80"></div>
    <div class="skeleton-card"></div>
    <div class="skeleton-card"></div>
    <div class="skeleton-card"></div>
  </div>
</div>

<script>
const socialHrefs = {
  whatsapp: (v) => `https://wa.me/${v.replace(/\D/g,'')}`,
  instagram: (v) => `https://instagram.com/${v.replace('@','')}`,
  facebook: (v) => `https://facebook.com/${v}`,
  phone: (v) => `tel:${v}`,
  maps: (v) => `https://maps.google.com/?q=${encodeURIComponent(v)}`,
  website: (v) => v,
  email: (v) => `mailto:${v}`,
  tiktok: (v) => `https://tiktok.com/@${v.replace('@','')}`,
  linkedin: (v) => `https://linkedin.com/company/${v}`,
  youtube: (v) => `https://youtube.com/@${v}`,
};

function toggleEmbed(btn) {
  btn.classList.toggle('expanded');
  btn.nextElementSibling.classList.toggle('open');
}

function renderProfile(data) {
  const theme = data.theme || 'midnight';
  document.body.className = `theme-${theme}`;
  document.body.style.background = `var(--screen-bg, var(--bg))`;
  document.title = `${data.business_name} â€” QR Profile`;

  const avatarStyle = data.avatar_style || 'initials';
  let avatar;
  if (avatarStyle === 'logo' && data.logo_url) {
    avatar = `<img class="avatar-img" src="${data.logo_url}" alt="${data.business_name}">`;
  } else if (avatarStyle === 'emoji') {
    avatar = data.emoji || '';
  } else {
    avatar = data.initials || '';
  }

  const socials = (data.socials || []).filter(s => s.enabled && s.value);
  const socialPills = socials.map(s => {
    const href = socialHrefs[s.id] ? socialHrefs[s.id](s.value) : '#';
    return `<a class="social-pill" href="${href}" target="_blank">
      <span class="social-pill-icon">${s.icon}</span>
      <span class="social-pill-label">${s.label}</span>
    </a>`;
  }).join('');

  const cards = (data.cards || []).map(renderCard).join('');

  document.getElementById('app').innerHTML = `
    <div class="profile-page">
      <div class="profile-hero">
        <div class="profile-hero-bg"></div>
        <div class="profile-hero-mesh"></div>
        <div class="avatar-ring">
          <div class="avatar-wrap">${avatar}</div>
        </div>
        <div class="profile-name">${data.business_name || ''}</div>
        <div class="profile-tagline">${data.tagline || ''}</div>
        <p class="profile-bio">${data.bio || ''}</p>
        <div class="verified-badge">
          <svg width="10" height="10" viewBox="0 0 24 24" fill="currentColor"><path d="M9 12l2 2 4-4M7.835 4.697a3.42 3.42 0 001.946-.806 3.42 3.42 0 014.438 0 3.42 3.42 0 001.946.806 3.42 3.42 0 013.138 3.138 3.42 3.42 0 00.806 1.946 3.42 3.42 0 010 4.438 3.42 3.42 0 00-.806 1.946 3.42 3.42 0 01-3.138 3.138 3.42 3.42 0 00-1.946.806 3.42 3.42 0 01-4.438 0 3.42 3.42 0 00-1.946-.806 3.42 3.42 0 01-3.138-3.138 3.42 3.42 0 00-.806-1.946 3.42 3.42 0 010-4.438 3.42 3.42 0 00.806-1.946 3.42 3.42 0 013.138-3.138z"/></svg>
          Verified Business
        </div>
      </div>
      <div class="social-strip">${socialPills}</div>
      <div class="cards-container">${cards}</div>
      <div class="profile-footer">
        <a class="powered-by" href="/">Powered by <span class="powered-by-logo">QR<span>Profile</span></span></a>
      </div>
    </div>`;
}

function renderCard(card) {
  switch(card.type) {
    case 'link': return renderLinkCard(card);
    case 'whatsapp': return renderWhatsappCard(card);
    case 'map': return renderMapCard(card);
    case 'website': return renderWebsiteCard(card);
    case 'google': return renderGoogleCard(card);
    case 'cta': return renderCtaCard(card);
    case 'text': return renderTextCard(card);
    case 'video': return renderVideoCard(card);
    case 'image': return renderImageCard(card);
    case 'image_grid': return renderImageGridCard(card);
    case 'audio': return renderAudioCard(card);
    case 'pdf': return renderPdfCard(card);
    case 'countdown': return renderCountdownCard(card);
    case 'rss_feed': return renderRssFeedCard(card);
    case 'contact_form': return renderContactFormCard(card);
    case 'email_capture': return renderEmailCaptureCard(card);
    case 'poll': return renderPollCard(card);
    case 'faq': return renderFaqCard(card);
    case 'testimonial': return renderTestimonialCard(card);
    case 'product': return renderProductCard(card);
    case 'booking': return renderBookingCard(card);
    case 'tip_jar': return renderTipJarCard(card);
    case 'instagram_post': return renderInstagramCard(card);
    case 'tweet': return renderTweetCard(card);
    case 'tiktok_post': return renderTiktokCard(card);
    case 'spotify': return renderSpotifyCard(card);
    default: return renderLinkCard(card);
  }
}

function renderLinkCard(c){return `<div class="qr-card"><a class="card-link" href="${c.url||'#'}" target="_blank"><div class="card-link-icon" style="background:rgba(108,99,255,0.15)">${c.icon||'\ud83d\udd17'}</div><div class="card-link-content"><div class="card-link-title">${c.title}</div><div class="card-link-sub">${c.sub||c.url||''}</div></div><div class="card-link-arrow"><svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><path d="M5 12h14M12 5l7 7-7 7"/></svg></div></a></div>`;}

function renderWhatsappCard(c){const href=`https://wa.me/${(c.phone||'').replace(/\D/g,'')}?text=${encodeURIComponent(c.message||'')}`;return `<div class="qr-card" style="background:linear-gradient(135deg,rgba(18,140,50,0.15),rgba(37,211,102,0.08));border-color:rgba(37,211,102,0.15)"><a class="card-link" href="${href}" target="_blank"><div class="card-link-icon" style="background:rgba(37,211,102,0.15);font-size:22px">\ud83d\udcac</div><div class="card-link-content"><div class="card-link-title">${c.title}</div><div class="card-link-sub">${c.message||'Send a message'}</div></div><div class="card-link-arrow" style="color:#4ade80"><svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><path d="M5 12h14M12 5l7 7-7 7"/></svg></div></a></div>`;}

function renderMapCard(c){const isE=c.view==='embed';const embedSrc=c.embedUrl||'';const hasEmbed=embedSrc.includes('google.com/maps');return `<div class="qr-card"><button class="card-expand-btn ${isE?'expanded':''}" onclick="toggleEmbed(this)"><div class="card-link-icon" style="background:rgba(234,67,53,0.15);font-size:20px">\ud83d\udccd</div><div class="card-expand-label"><div class="card-expand-title">${c.title}</div><div class="card-expand-sub">${hasEmbed?'Map embedded':'No map set'}</div></div><div class="card-expand-chevron"><svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><polyline points="6 9 12 15 18 9"/></svg></div></button><div class="card-embed-area ${isE?'open':''}">${hasEmbed?`<iframe src="${embedSrc}" class="map-embed-frame" allowfullscreen loading="lazy"></iframe>`:`<div style="padding:24px 18px;text-align:center;color:var(--text3);font-size:13px">No map configured</div>`}</div></div>`;}

function renderWebsiteCard(c){const isE=c.view==='embed';return `<div class="qr-card"><button class="card-expand-btn ${isE?'expanded':''}" onclick="toggleEmbed(this)"><div class="card-link-icon" style="background:rgba(14,165,233,0.15);font-size:20px">\ud83c\udf10</div><div class="card-expand-label"><div class="card-expand-title">${c.title}</div><div class="card-expand-sub">${c.url||''}</div></div><div class="card-expand-chevron"><svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><polyline points="6 9 12 15 18 9"/></svg></div></button><div class="card-embed-area ${isE?'open':''}"><div class="website-preview-bar"><div class="browser-dots2"><div class="browser-dot2" style="background:#ff5f57"></div><div class="browser-dot2" style="background:#febc2e"></div><div class="browser-dot2" style="background:#28c840"></div></div><div class="url-bar">${c.url||'https://'}</div></div><div class="website-preview-placeholder"><div class="site-name">${c.title}</div><div class="site-url">${c.url||''}</div></div><div style="padding:10px 18px;display:flex;justify-content:space-between;align-items:center;background:rgba(255,255,255,0.02);border-top:1px solid rgba(255,255,255,0.05)"><span style="font-size:11px;color:var(--text3)">Preview</span><a href="${c.url}" target="_blank" style="font-size:12px;font-weight:600;color:#38bdf8;text-decoration:none">Visit \u2192</a></div></div></div>`;}

function renderGoogleCard(c){const stars='\u2605'.repeat(Math.round(parseFloat(c.rating||5))).padEnd(5,'\u2606');return `<div class="qr-card"><div class="gbiz-inner"><div class="gbiz-brand-row"><div class="gbiz-g-icon"><svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z" fill="#4285F4"/><path d="M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z" fill="#34A853"/><path d="M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z" fill="#FBBC05"/><path d="M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z" fill="#EA4335"/></svg></div><div><div class="gbiz-biz-name">${c.biz||c.title}</div><div class="gbiz-biz-cat">Google Business Profile</div></div></div><div class="gbiz-stats-row"><div class="gbiz-stat"><div class="gbiz-stat-val">${c.rating||'5.0'}</div><div class="gbiz-stat-label">Rating</div></div><div class="gbiz-divider"></div><div class="gbiz-stat"><div class="stars2">${[...stars].map(s=>`<span class="star2">${s}</span>`).join('')}</div></div><div class="gbiz-divider"></div><div class="gbiz-stat"><div class="gbiz-stat-val">${c.reviews||'0'}</div><div class="gbiz-stat-label">Reviews</div></div></div></div><div class="gbiz-actions"><a href="${c.url||'#'}" target="_blank" class="gbiz-action-btn gbiz-action-primary" style="text-align:center;text-decoration:none;display:block;">Write a Review</a><a href="${c.url||'#'}" target="_blank" class="gbiz-action-btn gbiz-action-secondary" style="text-align:center;text-decoration:none;display:block;">View Profile</a></div></div>`;}

function renderCtaCard(c){return `<div class="qr-card"><div class="cta-card"><div class="cta-badge">${c.badge||'\u26a1 Offer'}</div><div class="cta-title">${c.title}</div><div class="cta-desc">${c.desc||''}</div><a href="${c.url||'#'}" target="_blank" class="cta-action">${c.btnText||'Learn More'} <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round"><path d="M5 12h14M12 5l7 7-7 7"/></svg></a></div></div>`;}

function renderTextCard(c){return `<div class="qr-card"><div style="padding:20px 18px;background:rgba(255,255,255,0.04)"><div style="font-family:'Syne',sans-serif;font-size:15px;font-weight:700;color:var(--white);margin-bottom:8px">${c.title}</div><div style="font-size:13px;color:var(--text2);line-height:1.7">${c.content||''}</div></div></div>`;}

function renderVideoCard(c){const isE=c.view==='embed';return `<div class="qr-card"><button class="card-expand-btn ${isE?'expanded':''}" onclick="toggleEmbed(this)"><div class="card-link-icon" style="background:rgba(255,0,0,0.12);font-size:20px">\u25b6\ufe0f</div><div class="card-expand-label"><div class="card-expand-title">${c.title}</div><div class="card-expand-sub">YouTube Video</div></div><div class="card-expand-chevron"><svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><polyline points="6 9 12 15 18 9"/></svg></div></button><div class="card-embed-area ${isE?'open':''}"><iframe src="${c.url||''}" height="200" allowfullscreen style="width:100%;border:none;display:block"></iframe></div></div>`;}

function renderImageCard(c){const inner=`<div class="qr-card" style="padding:0;overflow:hidden">${c.imageUrl?`<img src="${c.imageUrl}" alt="${c.altText||c.title||''}" style="width:100%;max-height:220px;object-fit:cover;display:block">`:''}${c.caption||c.title?`<div style="padding:12px 16px">${c.title?`<div style="font-weight:600;font-size:14px;color:var(--white);margin-bottom:4px">${c.title}</div>`:''}${c.caption?`<div style="font-size:12px;color:var(--text2)">${c.caption}</div>`:''}</div>`:''}</div>`;return c.linkUrl?`<a href="${c.linkUrl}" target="_blank" style="text-decoration:none">${inner}</a>`:inner;}

function renderImageGridCard(c){const cols=parseInt(c.columns)||2;const imgs=[{url:c.image1Url,link:c.image1Link},{url:c.image2Url,link:c.image2Link},{url:c.image3Url,link:c.image3Link}].slice(0,cols);return `<div class="qr-card">${c.title?`<div style="padding:12px 16px 8px;font-weight:600;font-size:14px;color:var(--white)">${c.title}</div>`:''}<div style="display:grid;grid-template-columns:repeat(${cols},1fr);gap:6px;padding:8px 12px 12px">${imgs.map(img=>{const el=img.url?`<img src="${img.url}" alt="" style="width:100%;aspect-ratio:1;object-fit:cover;border-radius:8px;display:block">`:`<div style="width:100%;aspect-ratio:1;background:rgba(255,255,255,0.04);border-radius:8px"></div>`;return img.link?`<a href="${img.link}" target="_blank">${el}</a>`:el;}).join('')}</div></div>`;}

function renderAudioCard(c){const isE=c.view==='embed';let embed='';if(c.platform==='Spotify'&&c.embedUrl){const src=c.embedUrl.includes('/embed/')?c.embedUrl:c.embedUrl.replace('open.spotify.com/','open.spotify.com/embed/');embed=`<iframe src="${src}?theme=0" height="152" style="width:100%;border:none;border-radius:12px" allow="autoplay;clipboard-write;encrypted-media" loading="lazy"></iframe>`;}else if(c.platform==='SoundCloud'&&c.embedUrl){embed=`<iframe src="${c.embedUrl}" height="166" style="width:100%;border:none" loading="lazy"></iframe>`;}else if(c.embedUrl){embed=`<audio controls src="${c.embedUrl}" style="width:100%;margin:12px 0"></audio>`;}else{embed='<div style="padding:18px;text-align:center;color:var(--text3);font-size:12px">No audio</div>';}return `<div class="qr-card"><button class="card-expand-btn ${isE?'expanded':''}" onclick="toggleEmbed(this)"><div class="card-link-icon" style="background:rgba(30,215,96,0.15);font-size:20px">ðŸŽµ</div><div class="card-expand-label"><div class="card-expand-title">${c.title}</div><div class="card-expand-sub">${c.platform||'Audio'}</div></div><div class="card-expand-chevron"><svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><polyline points="6 9 12 15 18 9"/></svg></div></button><div class="card-embed-area ${isE?'open':''}" style="padding:8px">${embed}</div></div>`;}

function renderPdfCard(c){return `<div class="qr-card"><a class="card-link" href="${c.pdfUrl||'#'}" target="_blank" style="text-decoration:none"><div class="card-link-icon" style="background:rgba(239,68,68,0.15);font-size:22px">ðŸ“„</div><div class="card-link-content"><div class="card-link-title">${c.title}</div><div class="card-link-sub">${c.description||'Open PDF â†’'}</div></div><div class="card-link-arrow"><svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><path d="M5 12h14M12 5l7 7-7 7"/></svg></div></a></div>`;}

function renderCountdownCard(c){const cid='cd-'+c.id;setTimeout(()=>{const target=new Date(c.targetDate).getTime();if(!c.targetDate)return;function tick(){const el=document.getElementById(cid);if(!el)return;const diff=target-Date.now();if(diff<=0){el.innerHTML=`<div style="font-size:14px;color:var(--text2)">${c.expiredText||'Expired'}</div>`;return;}const d=Math.floor(diff/86400000),h=Math.floor((diff%86400000)/3600000),m=Math.floor((diff%3600000)/60000),s=Math.floor((diff%60000)/1000);const box=(v,l)=>`<div style="background:var(--accent-color,var(--accent));border-radius:8px;padding:10px 12px;min-width:52px"><div style="font-size:22px;font-weight:700;font-family:monospace;color:#000">${String(v).padStart(2,'0')}</div><div style="font-size:9px;color:rgba(0,0,0,0.6);margin-top:2px">${l}</div></div>`;el.innerHTML=box(d,'DAYS')+box(h,'HRS')+box(m,'MIN')+box(s,'SEC');setTimeout(tick,1000);}tick();},100);return `<div class="qr-card"><div style="padding:18px;text-align:center">${c.title?`<div style="font-family:'Syne',sans-serif;font-size:15px;font-weight:700;color:var(--white);margin-bottom:6px">${c.title}</div>`:''}<div id="${cid}" style="display:flex;gap:8px;justify-content:center"><div style="background:var(--accent-color,var(--accent));border-radius:8px;padding:10px 12px;min-width:52px"><div style="font-size:22px;font-weight:700;font-family:monospace;color:#000">--</div><div style="font-size:9px;color:rgba(0,0,0,0.6);margin-top:2px">DAYS</div></div><div style="background:var(--accent-color,var(--accent));border-radius:8px;padding:10px 12px;min-width:52px"><div style="font-size:22px;font-weight:700;font-family:monospace;color:#000">--</div><div style="font-size:9px;color:rgba(0,0,0,0.6);margin-top:2px">HRS</div></div><div style="background:var(--accent-color,var(--accent));border-radius:8px;padding:10px 12px;min-width:52px"><div style="font-size:22px;font-weight:700;font-family:monospace;color:#000">--</div><div style="font-size:9px;color:rgba(0,0,0,0.6);margin-top:2px">MIN</div></div><div style="background:var(--accent-color,var(--accent));border-radius:8px;padding:10px 12px;min-width:52px"><div style="font-size:22px;font-weight:700;font-family:monospace;color:#000">--</div><div style="font-size:9px;color:rgba(0,0,0,0.6);margin-top:2px">SEC</div></div></div></div></div>`;}

function renderRssFeedCard(c){const cid='rss-'+c.id;if(c.feedUrl){setTimeout(async()=>{const el=document.getElementById(cid);if(!el)return;try{const res=await fetch(`https://api.rss2json.com/v1/api.json?rss_url=${encodeURIComponent(c.feedUrl)}`);const data=await res.json();if(data.items){el.innerHTML=data.items.slice(0,parseInt(c.maxItems)||3).map(item=>{const date=item.pubDate?new Date(item.pubDate).toLocaleDateString():'';return `<a href="${item.link||'#'}" target="_blank" style="display:flex;align-items:center;gap:10px;padding:8px 0;border-bottom:1px solid rgba(255,255,255,0.05);text-decoration:none"><div style="font-size:14px">ðŸ“°</div><div style="flex:1;min-width:0"><div style="font-size:12px;font-weight:500;color:var(--white);white-space:nowrap;overflow:hidden;text-overflow:ellipsis">${item.title||''}</div><div style="font-size:10px;color:var(--text3)">${date}</div></div></a>`;}).join('');}else{el.innerHTML='<div style="font-size:12px;color:var(--text3)">Could not load feed</div>';}}catch{el.innerHTML='<div style="font-size:12px;color:var(--text3)">Failed to load RSS</div>';}},100);}return `<div class="qr-card"><div style="padding:16px 18px"><div style="font-family:'Syne',sans-serif;font-size:15px;font-weight:700;color:var(--white);margin-bottom:12px">${c.title}</div><div id="${cid}">${[1,2,3].map(()=>'<div style="height:18px;background:rgba(255,255,255,0.06);border-radius:6px;margin-bottom:8px;animation:shimmer 1.5s infinite"></div>').join('')}</div></div></div>`;}

function renderContactFormCard(c){const isE=c.view==='embed';const slug=window.location.pathname.split('/').filter(Boolean).pop();return `<div class="qr-card"><button class="card-expand-btn ${isE?'expanded':''}" onclick="toggleEmbed(this)"><div class="card-link-icon" style="background:rgba(59,130,246,0.15);font-size:20px">ðŸ“¬</div><div class="card-expand-label"><div class="card-expand-title">${c.title}</div><div class="card-expand-sub">Contact form</div></div><div class="card-expand-chevron"><svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><polyline points="6 9 12 15 18 9"/></svg></div></button><div class="card-embed-area ${isE?'open':''}"><form onsubmit="submitContactForm(event,'${slug}','${c.recipientEmail||''}','${(c.successMessage||'Sent!').replace(/'/g,"\\'")}')" style="padding:16px"><div style="margin-bottom:10px"><input type="text" name="name" placeholder="Your Name" required style="width:100%;padding:10px 12px;background:rgba(255,255,255,0.06);border:1px solid rgba(255,255,255,0.1);border-radius:8px;color:var(--white);font-size:13px;font-family:'Outfit',sans-serif"></div><div style="margin-bottom:10px"><input type="email" name="email" placeholder="Your Email" required style="width:100%;padding:10px 12px;background:rgba(255,255,255,0.06);border:1px solid rgba(255,255,255,0.1);border-radius:8px;color:var(--white);font-size:13px;font-family:'Outfit',sans-serif"></div>${c.showPhone?`<div style="margin-bottom:10px"><input type="tel" name="phone" placeholder="Phone" style="width:100%;padding:10px 12px;background:rgba(255,255,255,0.06);border:1px solid rgba(255,255,255,0.1);border-radius:8px;color:var(--white);font-size:13px;font-family:'Outfit',sans-serif"></div>`:''}${c.showMessage?`<div style="margin-bottom:10px"><textarea name="message" placeholder="Message" rows="3" style="width:100%;padding:10px 12px;background:rgba(255,255,255,0.06);border:1px solid rgba(255,255,255,0.1);border-radius:8px;color:var(--white);font-size:13px;font-family:'Outfit',sans-serif;resize:vertical"></textarea></div>`:''}<button type="submit" style="width:100%;padding:10px;background:var(--accent-color,var(--accent));color:white;border:none;border-radius:8px;font-size:13px;font-weight:600;cursor:pointer;font-family:'Outfit',sans-serif">Send Message</button><div class="contact-form-msg" style="margin-top:8px;font-size:12px;text-align:center"></div></form></div></div>`;}
async function submitContactForm(e,slug,recipientEmail,successMessage){e.preventDefault();const form=e.target;const fd={name:form.name?.value||'',email:form.email?.value||'',phone:form.phone?.value||'',message:form.message?.value||''};const msg=form.querySelector('.contact-form-msg');try{const res=await fetch('/api/forms/contact',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({profileSlug:slug,recipientEmail,formData:fd})});if(res.ok){msg.style.color='var(--accent3)';msg.textContent=successMessage;form.reset();}else{msg.style.color='#ef4444';msg.textContent='Something went wrong, please try again.';}}catch{msg.style.color='#ef4444';msg.textContent='Something went wrong, please try again.';}}

function renderEmailCaptureCard(c){return `<div class="qr-card"><div style="padding:18px"><div style="font-family:'Syne',sans-serif;font-size:15px;font-weight:700;color:var(--white);margin-bottom:10px">${c.title}</div><form onsubmit="submitEmailCapture(event,'${c.id}','${(c.webhookUrl||'').replace(/'/g,"\\'")}','${(c.successMessage||'Thanks!').replace(/'/g,"\\'")}')" style="display:flex;gap:8px"><input type="email" placeholder="${c.placeholder||'Enter your email'}" required style="flex:1;padding:10px 12px;background:rgba(255,255,255,0.06);border:1px solid rgba(255,255,255,0.1);border-radius:8px;color:var(--white);font-size:13px;font-family:'Outfit',sans-serif"><button type="submit" style="padding:10px 16px;background:var(--accent-color,var(--accent));color:white;border:none;border-radius:8px;font-size:13px;font-weight:600;cursor:pointer;font-family:'Outfit',sans-serif;white-space:nowrap">${c.buttonText||'Subscribe'}</button></form><div class="email-capture-msg" style="margin-top:8px;font-size:12px;text-align:center"></div></div></div>`;}
async function submitEmailCapture(e,cardId,webhookUrl,successMessage){e.preventDefault();const email=e.target.querySelector('input[type="email"]').value;const slug=window.location.pathname.split('/').filter(Boolean).pop();const msg=e.target.parentElement.querySelector('.email-capture-msg');const btn=e.target.querySelector('button[type="submit"]');btn.disabled=true;btn.textContent='...';try{const res=await fetch('/api/forms/subscribe',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({profileSlug:slug,cardId:String(cardId),email})});if(!res.ok){const d=await res.json().catch(()=>({}));msg.style.color='#ef4444';msg.textContent=d.error||'Something went wrong, please try again.';return;}if(webhookUrl){try{await fetch(webhookUrl,{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({email,slug,timestamp:new Date().toISOString()})});}catch{}}msg.style.color='var(--accent3)';msg.textContent=successMessage;e.target.reset();}catch{msg.style.color='#ef4444';msg.textContent='Something went wrong, please try again.';}finally{btn.disabled=false;btn.textContent=btn.dataset.label||'Subscribe';}}

function renderPollCard(c){const options=[c.option1,c.option2,c.option3,c.option4].filter(Boolean);const voted=localStorage.getItem('poll-voted-'+c.id);const cid='poll-'+c.id;const slug=window.location.pathname.split('/').filter(Boolean).pop();if(voted){setTimeout(async()=>{try{const res=await fetch(`/api/polls/${slug}/${c.id}`);if(res.ok){const{data}=await res.json();showPollResults(cid,options,data.counts);}}catch{}},100);}return `<div class="qr-card"><div style="padding:18px"><div style="font-family:'Syne',sans-serif;font-size:15px;font-weight:700;color:var(--white);margin-bottom:12px">${c.question||c.title}</div><div id="${cid}">${voted?options.map(()=>'<div style="height:36px;background:rgba(255,255,255,0.04);border-radius:8px;margin-bottom:6px"></div>').join(''):options.map((opt,i)=>`<button onclick="castPollVote('${slug}','${c.id}',${i},'${cid}')" style="width:100%;padding:10px 14px;margin-bottom:6px;background:rgba(255,255,255,0.06);border:1px solid rgba(255,255,255,0.1);border-radius:8px;color:var(--white);font-size:13px;cursor:pointer;text-align:left;font-family:'Outfit',sans-serif;transition:var(--transition)" onmouseover="this.style.borderColor='var(--accent)'" onmouseout="this.style.borderColor='rgba(255,255,255,0.1)'">${opt}</button>`).join('')}</div></div></div>`;}
async function castPollVote(slug,cardId,optionIndex,elemId){try{const res=await fetch('/api/polls/vote',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({slug,cardId:String(cardId),optionIndex})});if(res.ok){localStorage.setItem('poll-voted-'+cardId,'1');const{data}=await res.json();const el=document.getElementById(elemId);if(el){const btns=el.querySelectorAll('button');const options=Array.from(btns).map(b=>b.textContent);showPollResults(elemId,options,data.counts);}}}catch{}}
function showPollResults(elemId,options,counts){const el=document.getElementById(elemId);if(!el)return;const total=Object.values(counts).reduce((a,b)=>a+b,0)||1;el.innerHTML=options.map((opt,i)=>{const votes=counts[i]||0;const pct=Math.round((votes/total)*100);return `<div style="margin-bottom:6px;position:relative;background:rgba(255,255,255,0.04);border-radius:8px;overflow:hidden;padding:10px 14px"><div style="position:absolute;left:0;top:0;bottom:0;width:${pct}%;background:var(--accent-color,var(--accent));opacity:0.15;border-radius:8px;transition:width 0.5s"></div><div style="position:relative;display:flex;justify-content:space-between;font-size:13px"><span style="color:var(--white)">${opt}</span><span style="color:var(--text2);font-weight:600">${pct}%</span></div></div>`;}).join('');}

function renderFaqCard(c){const pairs=[];for(let i=1;i<=5;i++){if(c['q'+i])pairs.push({q:c['q'+i],a:c['a'+i]||''});}const fid='faq-'+c.id;return `<div class="qr-card"><div style="padding:16px 18px">${c.title?`<div style="font-family:'Syne',sans-serif;font-size:15px;font-weight:700;color:var(--white);margin-bottom:12px">${c.title}</div>`:''}${pairs.map((p,i)=>`<div style="border-bottom:1px solid rgba(255,255,255,0.06)"><button onclick="toggleFaqItem('${fid}',${i})" style="width:100%;display:flex;justify-content:space-between;align-items:center;padding:12px 0;background:none;border:none;color:var(--white);font-size:13px;font-weight:500;cursor:pointer;font-family:'Outfit',sans-serif;text-align:left"><span>${p.q}</span><span id="${fid}-chev-${i}" style="transition:transform 0.3s;font-size:10px">â–¼</span></button><div id="${fid}-${i}" style="max-height:0;overflow:hidden;transition:max-height 0.3s ease"><div style="padding:0 0 12px;font-size:12px;color:var(--text2);line-height:1.6">${p.a}</div></div></div>`).join('')}</div></div>`;}
function toggleFaqItem(fid,idx){const el=document.getElementById(fid+'-'+idx);const chev=document.getElementById(fid+'-chev-'+idx);if(!el)return;const isOpen=el.style.maxHeight&&el.style.maxHeight!=='0px';for(let i=0;i<5;i++){const o=document.getElementById(fid+'-'+i);const oc=document.getElementById(fid+'-chev-'+i);if(o)o.style.maxHeight='0px';if(oc)oc.style.transform='rotate(0deg)';}if(!isOpen){el.style.maxHeight=el.scrollHeight+'px';if(chev)chev.style.transform='rotate(180deg)';}}

function renderTestimonialCard(c){const stars='â˜…'.repeat(parseInt(c.rating)||5)+'â˜†'.repeat(5-(parseInt(c.rating)||5));const initials=(c.authorName||'').split(' ').map(w=>w[0]).join('').slice(0,2).toUpperCase();return `<div class="qr-card" style="background:linear-gradient(135deg,rgba(255,255,255,0.04),rgba(255,255,255,0.02));border:1px solid rgba(255,255,255,0.08)"><div style="padding:20px 18px"><div style="font-size:36px;color:var(--accent-color,var(--accent));opacity:0.4;line-height:1;margin-bottom:8px">"</div><div style="font-size:14px;color:var(--white);font-style:italic;line-height:1.7;margin-bottom:14px">${c.quote||''}</div><div style="color:#f7c948;font-size:14px;margin-bottom:12px;letter-spacing:2px">${stars}</div><div style="display:flex;align-items:center;gap:10px">${c.authorAvatarUrl?`<img src="${c.authorAvatarUrl}" style="width:36px;height:36px;border-radius:50%;object-fit:cover">`:`<div style="width:36px;height:36px;border-radius:50%;background:rgba(255,255,255,0.08);display:flex;align-items:center;justify-content:center;font-size:13px;font-weight:700;color:var(--accent-color,var(--accent))">${initials}</div>`}<div><div style="font-size:13px;font-weight:600;color:var(--white)">${c.authorName||''}</div><div style="font-size:11px;color:var(--text3)">${c.authorTitle||''}</div></div></div></div></div>`;}

function renderProductCard(c){const sym={ZAR:'R',USD:'$',EUR:'â‚¬',GBP:'Â£'}[c.currency]||c.currency||'R';return `<div class="qr-card"><div style="padding:16px 18px"><div style="display:flex;gap:14px;margin-bottom:14px"><div style="position:relative;flex-shrink:0">${c.imageUrl?`<img src="${c.imageUrl}" style="width:80px;height:80px;border-radius:10px;object-fit:cover">`:`<div style="width:80px;height:80px;border-radius:10px;background:rgba(255,255,255,0.06);display:flex;align-items:center;justify-content:center;font-size:24px">ðŸ›ï¸</div>`}${c.badge?`<div style="position:absolute;top:-4px;right:-4px;background:var(--accent-color,var(--accent));color:#000;font-size:9px;font-weight:700;padding:2px 6px;border-radius:10px">${c.badge}</div>`:''}</div><div style="flex:1;min-width:0"><div style="font-weight:600;font-size:14px;color:var(--white);margin-bottom:4px">${c.productName||c.title}</div><div style="font-size:12px;color:var(--text2);margin-bottom:8px;line-height:1.5">${c.description||''}</div><div style="font-size:18px;font-weight:700;color:var(--accent-color,var(--accent))">${sym}${c.price||'0'}</div></div></div><a href="${c.buyUrl||'#'}" target="_blank" style="display:block;text-align:center;padding:10px;background:var(--accent-color,var(--accent));color:#000;font-weight:600;font-size:13px;border-radius:8px;text-decoration:none;font-family:'Outfit',sans-serif">Buy Now</a></div></div>`;}

function renderBookingCard(c){const isE=c.view==='embed';return `<div class="qr-card"><button class="card-expand-btn ${isE?'expanded':''}" onclick="toggleEmbed(this)"><div class="card-link-icon" style="background:rgba(59,130,246,0.15);font-size:20px">ðŸ“…</div><div class="card-expand-label"><div class="card-expand-title">${c.title}</div><div class="card-expand-sub">${c.description||'Book Now â†’'}</div></div><div class="card-expand-chevron"><svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><polyline points="6 9 12 15 18 9"/></svg></div></button><div class="card-embed-area ${isE?'open':''}">${c.embedUrl?`<iframe src="${c.embedUrl}" style="width:100%;height:500px;border:none" loading="lazy"></iframe>`:'<div style="padding:24px;text-align:center;color:var(--text3);font-size:13px">No booking URL set</div>'}</div></div>`;}

function renderTipJarCard(c){const emoji={'Buy Me a Coffee':'â˜•','Ko-fi':'ðŸ’›','PayPal':'ðŸ’™','Custom':'ðŸ’°'}[c.platform]||'ðŸ’°';const amounts=(c.suggestedAmounts||'5,10,25').split(',').map(s=>s.trim()).filter(Boolean).slice(0,3);const sym={USD:'$',ZAR:'R',EUR:'â‚¬',GBP:'Â£'}[c.currency]||'$';return `<div class="qr-card"><div style="padding:18px;text-align:center"><div style="font-size:32px;margin-bottom:8px">${emoji}</div><div style="font-family:'Syne',sans-serif;font-size:15px;font-weight:700;color:var(--white);margin-bottom:4px">${c.title}</div><div style="font-size:12px;color:var(--text2);margin-bottom:14px">${c.description||''}</div><div style="display:flex;gap:8px;justify-content:center;margin-bottom:14px">${amounts.map(a=>`<span style="padding:6px 16px;border-radius:20px;background:rgba(255,255,255,0.06);border:1px solid rgba(255,255,255,0.1);color:var(--white);font-size:13px;font-weight:600">${sym}${a}</span>`).join('')}</div><a href="${c.paymentUrl||'#'}" target="_blank" style="display:inline-block;padding:10px 24px;background:var(--accent-color,var(--accent));color:#000;font-weight:600;font-size:13px;border-radius:8px;text-decoration:none;font-family:'Outfit',sans-serif">Send Tip â†’</a></div></div>`;}

function renderInstagramCard(c){const isE=c.view==='embed';return `<div class="qr-card"><button class="card-expand-btn ${isE?'expanded':''}" onclick="toggleEmbed(this)"><div class="card-link-icon" style="background:rgba(228,64,95,0.15);font-size:20px">ðŸ“¸</div><div class="card-expand-label"><div class="card-expand-title">${c.title}</div><div class="card-expand-sub">Instagram Post</div></div><div class="card-expand-chevron"><svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><polyline points="6 9 12 15 18 9"/></svg></div></button><div class="card-embed-area ${isE?'open':''}"><div style="padding:24px;text-align:center"><div style="font-size:28px;margin-bottom:8px">ðŸ“¸</div>${c.postUrl?`<a href="${c.postUrl}" target="_blank" style="font-size:13px;font-weight:600;color:#e4405f;text-decoration:none">Open on Instagram â†’</a>`:'<div style="font-size:12px;color:var(--text3)">No URL set</div>'}</div></div></div>`;}

function renderTweetCard(c){const isE=c.view==='embed';return `<div class="qr-card"><button class="card-expand-btn ${isE?'expanded':''}" onclick="toggleEmbed(this)"><div class="card-link-icon" style="background:rgba(29,155,240,0.15);font-size:20px">ð•</div><div class="card-expand-label"><div class="card-expand-title">${c.title}</div><div class="card-expand-sub">Post on X</div></div><div class="card-expand-chevron"><svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><polyline points="6 9 12 15 18 9"/></svg></div></button><div class="card-embed-area ${isE?'open':''}"><div style="padding:24px;text-align:center">${c.tweetUrl?`<blockquote class="twitter-tweet" data-theme="dark"><a href="${c.tweetUrl}"></a></blockquote><div style="margin-top:8px"><a href="${c.tweetUrl}" target="_blank" style="font-size:13px;font-weight:600;color:#1d9bf0;text-decoration:none">View on X â†’</a></div>`:'<div style="font-size:12px;color:var(--text3)">No tweet URL set</div>'}</div></div></div>`;}

function renderTiktokCard(c){const isE=c.view==='embed';return `<div class="qr-card"><button class="card-expand-btn ${isE?'expanded':''}" onclick="toggleEmbed(this)"><div class="card-link-icon" style="background:rgba(255,0,80,0.15);font-size:20px">ðŸŽµ</div><div class="card-expand-label"><div class="card-expand-title">${c.title}</div><div class="card-expand-sub">TikTok Video</div></div><div class="card-expand-chevron"><svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><polyline points="6 9 12 15 18 9"/></svg></div></button><div class="card-embed-area ${isE?'open':''}"><div style="padding:24px;text-align:center">${c.tiktokUrl?`<a href="${c.tiktokUrl}" target="_blank" style="font-size:13px;font-weight:600;color:#ff0050;text-decoration:none">Watch on TikTok â†’</a>`:'<div style="font-size:12px;color:var(--text3)">No TikTok URL set</div>'}</div></div></div>`;}

function renderSpotifyCard(c){let src=c.spotifyUrl||'';if(src&&!src.includes('/embed/'))src=src.replace('open.spotify.com/','open.spotify.com/embed/');const h=c.compact?152:352;return `<div class="qr-card" style="padding:0;overflow:hidden">${src?`<iframe src="${src}?theme=0" height="${h}" style="width:100%;border:none;border-radius:12px" allow="autoplay;clipboard-write;encrypted-media" loading="lazy"></iframe>`:'<div style="padding:24px;text-align:center;color:var(--text3);font-size:13px">No Spotify URL set</div>'}</div>`;}

function show404() {
  document.getElementById('app').innerHTML = `<div class="not-found"><h1>404</h1><p>This profile doesn't exist or may have been removed.</p><a href="/">Go to homepage</a></div>`;
}

// Boot
(async function() {
  const parts = window.location.pathname.split('/').filter(Boolean);
  // URL is /p/slug
  const slug = parts[parts.length - 1];
  if (!slug || slug === 'p') { show404(); return; }

  try {
    const res = await fetch(`/api/profiles/${slug}`);
    if (!res.ok) { show404(); return; }
    const json = await res.json();
    renderProfile(json.data);
  } catch {
    show404();
  }
})();
</script>
</body>
</html>
